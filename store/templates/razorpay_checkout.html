{% extends 'base.html' %}

{% block carousel %}

{% endblock %}

{% block content %}


<body>
  <div style="max-width: 800px; margin: 40px auto; text-align: center; font-family: sans-serif;">
    <h2>Order Items</h2>

  {% if items %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background-color: #ffffff;">
                <th style="padding: 12px; border: 1px solid #cdcdcd;">Product</th>
                <th style="padding: 12px; border: 1px solid #cdcdcd;">Quantity</th>
                <th style="padding: 12px; border: 1px solid #cdcdcd;">Price</th>
            </tr>
        </thead>
        <tbody>
            {% for i in items %}
            <tr>
                <td style="padding: 10px; border: 1px solid #8a8a8a;">{{ i.product_item.title }}</td>
                
                <td style="padding: 10px; border: 1px solid #8a8a8a;">{{ i.quantity }}</td>
                <td style="padding: 10px; border: 1px solid #8a8a8a;">₹{{ i.product_item.price }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

  <h3 class="text-lg font-bold">Total Amount: ₹{{ amount|floatformat:2 }}</h3>

  <button id="rzp-button" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded">
    Place Order
  </button>

  </div>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script>
    var options = {
      "key": "{{ razorpay_key_id }}",  // Replace with your Razorpay API key
      "amount": "{{ amount|safe }}",  // Amount in paise
      "currency": "INR",
      "name": "CartNest",
      "description": "Order Payment",
      "image": "",  // Optional
      "order_id": "{{ order_id|safe }}",  // Razorpay order ID from server
      "handler": function (response) {
        fetch("/store/payment_success/", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}"
          },
          body: ` razorpay_payment_id=${response.razorpay_payment_id}&razorpay_order_id=${options.order_id}`
        }).then(() => {
          alert("Payment successful!");
          window.location.href = "/store/payment_success/";
        });
      },
      "prefill": {
        "name": "{{ order.customer.username }}",
        "email": "{{ order.customer.email }}",
        "contact": "{{ order.phone_number }}"
      },
      "theme": {
        "color": "#F37254"
      }
    };

    var rzp = new Razorpay(options);
    document.getElementById('rzp-button').onclick = function (e) {
      rzp.open();
      e.preventDefault();
    }
  </script>
  {% else %}
  <p>No items in order.</p>
  {% endif %}
</body>
{% endblock %}