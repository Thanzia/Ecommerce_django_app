{% extends 'base.html' %}
{% block title %}
<title>Razorpay Checkout</title>
{% endblock %}

{% block carousel %}
{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 50px auto; font-family: sans-serif;">
    <h2 style="text-align: center; font-size: 1.8rem; font-weight: bold; margin-bottom: 20px; color: #b91c1c;">
        Order Items
    </h2>

    {% if items %}
    <div style="background-color: #ffffff; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 20px;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #fbbf24; color: #111827;">
                    <th style="padding: 14px; text-align: left; font-weight: 700;">Product</th>
                    <th style="padding: 14px; text-align: center; font-weight: 700;">Quantity</th>
                    <th style="padding: 14px; text-align: right; font-weight: 700;">Price</th>
                </tr>
            </thead>
            <tbody>
                {% for i in items %}
                <tr style="border-bottom: 1px solid #e5e7eb;">
                    <td style="padding: 12px; text-align: left; color: #1f2937;">
                        {{ i.product.title }}
                    </td>
                    <td style="padding: 12px; text-align: center; color: #1f2937;">
                        {{ i.quantity }}
                    </td>
                    <td style="padding: 12px; text-align: right; color: #1f2937;">
                        ₹{{ i.product.price }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <h3 style="text-align: right; font-size: 1.2rem; font-weight: bold; color: #1f2937; margin-bottom: 20px;">
        Total Amount: ₹{{ amount|floatformat:2 }}
    </h3>

    <div style="text-align: right;">
        <button id="rzp-button"
            style="background-color: #f59e0b; color: white; font-weight: 600; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; transition: background-color 0.3s ease;"
            onmouseover="this.style.backgroundColor='#d97706'" onmouseout="this.style.backgroundColor='#f59e0b'">
            Place Order
        </button>
    </div>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      var options = {
        "key": "{{ razorpay_key_id }}",
        "amount": "{{ amount|safe }}",
        "currency": "INR",
        "name": "CartNest",
        "description": "Order Payment",
        "order_id": "{{ order_id|safe }}",
        "handler": function (response) {
          fetch("/store/payment_success/", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
              "X-CSRFToken": "{{ csrf_token }}"
            },
            body: `razorpay_payment_id=${response.razorpay_payment_id}&razorpay_order_id=${options.order_id}`
          }).then(() => {
            alert("Payment successful!");
            window.location.href = "/store/payment_success/";
          });
        },
        "prefill": {
          "name": "{{ order.customer.username }}",
          "email": "{{ order.customer.email }}",
          "contact": "{{ order.phone_number }}"
        },
        "theme": {
          "color": "#F37254"
        }
      };

      var rzp = new Razorpay(options);
      document.getElementById('rzp-button').onclick = function (e) {
        rzp.open();
        e.preventDefault();
      }
    </script>

    {% else %}
    <p style="text-align: center; color: #6b7280; font-size: 1rem; margin-top: 40px;">No items in order.</p>
    {% endif %}
</div>
{% endblock %}
